<?xml version="1.0" encoding="utf-8"?>
<!-- 
  WinSW Configuration for Reflex Application
  Place alongside WinSW.exe (renamed to match app name)
  Download: https://github.com/winsw/winsw/releases/download/v2.12.0/WinSW.NET461.exe
-->
<service>
  <!-- === Service Identity === -->
  <id>ReflexApp</id>
  <name>Reflex Application Service</name>
  <description>Reflex full-stack Python application running on Uvicorn</description>
  
  <!-- === Executable Configuration === -->
  <executable>%BASE%\.venv\Scripts\python.exe</executable>
  <arguments>-m reflex run --env prod --backend-only --backend-port 8000</arguments>
  <workingdirectory>%BASE%</workingdirectory>
  
  <!-- === Environment Variables === -->
  <env name="REFLEX_ENV" value="production"/>
  <env name="API_URL" value="https://myapp.corp.com"/>
  <env name="DATABASE_URL" value="postgresql://user:pass@dbserver/myapp"/>
  <env name="PYTHONUNBUFFERED" value="1"/>
  
  <!-- === Logging with Rotation === -->
  <logpath>%BASE%\logs</logpath>
  <log mode="roll-by-size">
    <sizeThreshold>10240</sizeThreshold>  <!-- 10MB -->
    <keepFiles>10</keepFiles>
  </log>
  
  <!-- === Service Startup === -->
  <startmode>Automatic</startmode>
  <delayedAutoStart>true</delayedAutoStart>
  
  <!-- === Dependencies (wait for network) === -->
  <depend>Tcpip</depend>
  <depend>Dnscache</depend>
  
  <!-- === Recovery on Failure === -->
  <onfailure action="restart" delay="10 sec"/>
  <onfailure action="restart" delay="30 sec"/>
  <onfailure action="restart" delay="60 sec"/>
  <resetfailure>1 hour</resetfailure>
  
  <!-- === Graceful Shutdown === -->
  <stoptimeout>30 sec</stoptimeout>
  <stopparentprocessfirst>true</stopparentprocessfirst>
  
  <!-- === Security (run as service account) === -->
  <serviceaccount>
    <user>NetworkService</user>
  </serviceaccount>
</service>
